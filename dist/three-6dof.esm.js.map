{"version":3,"file":"three-6dof.esm.js","sources":["../src/uniforms.ts","../src/index.ts"],"sourcesContent":["import { Vector2, Vector4 } from 'three'\n\nconst Uniforms = {\n  map: {\n    type: 't',\n    value: null,\n  },\n  depthMap: {\n    type: 't',\n    value: null,\n  },\n  time: {\n    type: 'f',\n    value: 0.0,\n  },\n  opacity: {\n    type: 'f',\n    value: 1.0,\n  },\n  pointSize: {\n    type: 'f',\n    value: 3.0,\n  },\n  debugDepth: {\n    type: 'f',\n    value: 0.0,\n  },\n  isSeperate: {\n    type: 'b',\n    value: false,\n  },\n  displacement: {\n    type: 'f',\n    value: 1.0,\n  },\n}\n\nexport default Uniforms\n","import {\n  Object3D,\n  Material,\n  ShaderMaterial,\n  TextureLoader,\n  BackSide,\n  Mesh,\n  Points,\n  SphereBufferGeometry,\n} from 'three'\n\n// Load shaders\nimport frag from './shaders/sixdof.frag'\nimport vert from './shaders/sixdof.vert'\n\nimport Uniforms from './uniforms'\n\nenum TextureType {\n  TOP_BOTTOM,\n  SEPERATE,\n}\n\nenum MeshDensity {\n  LOW = 64,\n  MEDIUM = 128,\n  HIGH = 256,\n  EXTRA_HIGH = 512,\n}\n\nenum Style {\n  WIRE,\n  POINTS,\n  MESH,\n}\n\nclass Viewer extends Object3D {\n  public props: object\n  protected loader: TextureLoader = new TextureLoader()\n  protected obj: Object3D\n  protected geometry: SphereBufferGeometry\n  protected material: Material = new ShaderMaterial({\n    uniforms: Uniforms,\n    vertexShader: vert,\n    fragmentShader: frag,\n    transparent: true,\n    side: BackSide,\n  })\n\n  constructor(\n    texturePath: string = undefined,\n    depthPath?: string,\n    textureType: TextureType = TextureType.SEPERATE,\n    meshDensity: MeshDensity = MeshDensity.EXTRA_HIGH,\n    style: Style = Style.MESH,\n    displacement: number = 1,\n  ) {\n    super()\n\n    if (!texturePath) {\n      throw new Error('Texture path must be defined when creating a viewer')\n    }\n\n    this.geometry = new SphereBufferGeometry(10, meshDensity, meshDensity)\n\n    this.material.uniforms.displacement.value = displacement\n\n    if (textureType === TextureType.SEPERATE) {\n      if (!depthPath) {\n        throw new Error(\n          'When using seperate textures you must provide a depth texture as well',\n        )\n      }\n\n      // Inform the shader we are providing two seperate textures\n      this.material.uniforms.isSeperate.value = true\n\n      // Load the depth map\n      this.load(depthPath)\n        .then(texture => {\n          this.material.uniforms.depthMap.value = texture\n        })\n        .catch(err => {\n          throw new Error(err)\n        })\n    }\n\n    // Load the texture\n    this.load(texturePath)\n      .then(texture => {\n        this.material.uniforms.map.value = texture\n      })\n      .catch(err => {\n        throw new Error(err)\n      })\n\n    // Create the Mesh/Points and add it to the viewer object\n    this.obj = this.createSceneObjectWithStyle(style)\n    this.add(this.obj)\n  }\n\n  /** An internal util to create the scene Object3D */\n  protected createSceneObjectWithStyle(style: Style): Object3D {\n    switch (style) {\n      case Style.WIRE:\n        this.material.wireframe = true\n      case Style.MESH:\n        return new Mesh(this.geometry, this.material)\n      case Style.POINTS:\n        return new Points(this.geometry, this.material)\n    }\n  }\n\n  /** Promised wrapper for the TextureLoader */\n  protected load(texturePath: string): Promise<string> {\n    return new Promise((resolve, reject) => {\n      this.loader.load(\n        texturePath,\n        texture => resolve(texture),\n        undefined,\n        () => reject(`Error loading texture error`),\n      )\n    })\n  }\n\n  /** Toggle vieweing texture or depthmap in viewer */\n  public toggleDepthDebug(state?: boolean): void {\n    this.material.uniforms.debugDepth.value =\n      state != undefined ? state : !this.material.uniforms.debugDepth.value\n  }\n\n  /** Setter for displacement amount */\n  public setDisplacement(amount: number): void {\n    this.material.uniforms.displacement.value = amount\n  }\n}\n\nexport { Viewer, TextureType }\n"],"names":["Uniforms","map","type","value","depthMap","time","opacity","pointSize","debugDepth","isSeperate","displacement","TextureType","MeshDensity","Style","Viewer","Object3D","constructor","texturePath","undefined","depthPath","textureType","SEPERATE","meshDensity","EXTRA_HIGH","style","MESH","props","loader","TextureLoader","obj","geometry","material","ShaderMaterial","uniforms","vertexShader","vert","fragmentShader","frag","transparent","side","BackSide","Error","SphereBufferGeometry","load","then","texture","err","createSceneObjectWithStyle","add","WIRE","wireframe","Mesh","POINTS","Points","Promise","resolve","reject","toggleDepthDebug","state","setDisplacement","amount"],"mappings":"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"}