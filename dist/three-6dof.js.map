{"version":3,"file":"three-6dof.js","sources":["../src/components/three.ts","../src/components/uniforms.ts","../src/components/style.ts","../src/components/density.ts","../src/components/texture.ts","../src/components/viewer.ts"],"sourcesContent":["/**\n * A small wrapper for THREE imports so rollup tree-shakes only the parts we need better\n */\n\nimport {\n    Object3D,\n    Material,\n    ShaderMaterial,\n    TextureLoader,\n    BackSide,\n    Mesh,\n    Points,\n    SphereBufferGeometry,\n} from 'three'\n\nexport {\n    Object3D,\n    Material,\n    ShaderMaterial,\n    TextureLoader,\n    BackSide,\n    Mesh,\n    Points,\n    SphereBufferGeometry,\n}","import { Vector2, Vector4 } from 'three'\n\nexport const Uniforms: object = {\n  map: {\n    type: 't',\n    value: null,\n  },\n  depthMap: {\n    type: 't',\n    value: null,\n  },\n  time: {\n    type: 'f',\n    value: 0.0,\n  },\n  opacity: {\n    type: 'f',\n    value: 1.0,\n  },\n  pointSize: {\n    type: 'f',\n    value: 3.0,\n  },\n  debugDepth: {\n    type: 'f',\n    value: 0.0,\n  },\n  isSeperate: {\n    type: 'b',\n    value: false,\n  },\n  displacement: {\n    type: 'f',\n    value: 1.0,\n  },\n}\n","export enum Style {\n    WIRE,\n    POINTS,\n    MESH,\n}","export enum MeshDensity {\n    LOW = 64,\n    MEDIUM = 128,\n    HIGH = 256,\n    EXTRA_HIGH = 512,\n}","export enum TextureType {\n    TOP_BOTTOM,\n    SEPERATE,\n}","import {\n    Object3D,\n    Material,\n    ShaderMaterial,\n    TextureLoader,\n    BackSide,\n    Mesh,\n    Points,\n    SphereBufferGeometry,\n} from './three'\n\nimport frag from '../shaders/sixdof.frag'\nimport vert from '../shaders/sixdof.vert'\n\nimport { Uniforms } from './uniforms'\nimport { Style } from './style'\nimport { MeshDensity } from './density'\nimport { TextureType } from './texture'\n\nexport default class Viewer extends Object3D {\n    public props: object\n    protected loader: TextureLoader = new TextureLoader()\n    protected obj: Object3D\n    protected geometry: SphereBufferGeometry\n    protected material: Material = new ShaderMaterial({\n        uniforms: Uniforms,\n        vertexShader: vert,\n        fragmentShader: frag,\n        transparent: true,\n        side: BackSide,\n    })\n\n    constructor(\n        texturePath: string = undefined,\n        depthPath?: string,\n        textureType: TextureType = TextureType.SEPERATE,\n        meshDensity: MeshDensity = MeshDensity.HIGH,\n        style: Style = Style.POINTS,\n        displacement: number = 1,\n    ) {\n        super()\n\n        if (!texturePath) {\n            throw new Error('Texture path must be defined when creating a viewer')\n        }\n\n        this.geometry = new SphereBufferGeometry(10, meshDensity, meshDensity)\n\n        this.material.uniforms.displacement.value = displacement\n\n        if (textureType === TextureType.SEPERATE) {\n            if (!depthPath) {\n                throw new Error(\n                    'When using seperate textures you must provide a depth texture as well',\n                )\n            }\n\n            /** Inform the shader we are providing two seperate textures */\n            this.material.uniforms.isSeperate.value = true\n\n            /** Load the depthmap */\n            this.load(depthPath)\n                .then(texture => {\n                    this.material.uniforms.depthMap.value = texture\n                })\n                .catch(err => {\n                    throw new Error(err)\n                })\n        }\n\n        /** Load the texture */\n        this.load(texturePath)\n            .then(texture => {\n                this.material.uniforms.map.value = texture\n            })\n            .catch(err => {\n                throw new Error(err)\n            })\n\n        // Create the Mesh/Points and add it to the viewer object\n        this.obj = this.createSceneObjectWithStyle(style)\n        this.add(this.obj)\n    }\n\n    /** An internal util to create the scene Object3D */\n    protected createSceneObjectWithStyle(style: Style): Object3D {\n        switch (style) {\n            case Style.WIRE:\n                this.material.wireframe = true\n            case Style.MESH:\n                return new Mesh(this.geometry, this.material)\n            case Style.POINTS:\n                return new Points(this.geometry, this.material)\n        }\n    }\n\n    /** Promised wrapper for the TextureLoader */\n    protected load(texturePath: string): Promise<string> {\n        return new Promise((resolve, reject) => {\n            this.loader.load(\n                texturePath,\n                texture => resolve(texture),\n                undefined,\n                () => reject(`Error loading texture error`),\n            )\n        })\n    }\n\n    /** Toggle vieweing texture or depthmap in viewer */\n    public toggleDepthDebug(state?: boolean): void {\n        this.material.uniforms.debugDepth.value =\n            state != undefined ? state : !this.material.uniforms.debugDepth.value\n    }\n\n    /** Setter for displacement amount */\n    public setDisplacement(amount: number): void {\n        this.material.uniforms.displacement.value = amount\n    }\n}"],"names":["Uniforms","map","type","value","depthMap","time","opacity","pointSize","debugDepth","isSeperate","displacement","Style","MeshDensity","TextureType","Viewer","Object3D","constructor","texturePath","undefined","depthPath","textureType","SEPERATE","meshDensity","HIGH","style","POINTS","props","loader","TextureLoader","obj","geometry","material","ShaderMaterial","uniforms","vertexShader","vert","fragmentShader","frag","transparent","side","BackSide","Error","SphereBufferGeometry","load","then","texture","err","createSceneObjectWithStyle","add","WIRE","wireframe","MESH","Mesh","Points","Promise","resolve","reject","toggleDepthDebug","state","setDisplacement","amount"],"mappings":"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"}